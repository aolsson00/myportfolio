<!DOCTYPE html>
<html>
<body>

<?php
//form data
$ticket_id=$_POST['ticket_id'];
$seat_num=$_POST['seat_num'];
$date=$_POST['date'];
$user_id=$_POST['user_id'];
$flight_num=$_POST['flight_num'];
$transaction_id=$_POST['transaction_id'];
$amount=$_POST['amount'];
$payment_mode=$_POST['payment_mode'];


//connection DSN
$host = "pluto.hood.edu";
$dbname = "ajo2db";
$user = "ajo2";
$pass = "password";

try {
    $conn = new PDO("mysql:host=$host;dbname=$dbname", $user, $pass);
    $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // use prepared statement with named placeholders :ticket_id, :seat_num, :date, :user_id, :flight_num, :transaction_id, :amount, :payment_mode.
    $sql = "INSERT INTO ticket_payment (ticket_id, seat_num, date, user_id, flight_num, transaction_id, amount, payment_mode) VALUES (:ticket_id, :seat_num, :date, :user_id, :flight_num, :transaction_id, :amount, :payment_mode)";
    $stmt = $conn->prepare($sql);

    $stmt->bindParam(':ticket_id', $ticket_id);
    $stmt->bindParam(':seat_num', $seat_num);
    $stmt->bindParam(':date', $date);
$stmt->bindParam(':user_id', $user_id);
$stmt->bindParam(':transaction_id', $transaction_id);
$stmt->bindParam(':amount', $amount);
$stmt->bindParam(':payment_mode', $payment_mode);

    if ($stmt->execute()) {
        $rows_affected = $stmt->rowCount();
        echo "<h2>".$rows_affected." row added successfully!</h2>";
        
        // Retrieve and display all customer data
        $stmt = $conn->query("SELECT * FROM ticket_payment");
        $stmt->setFetchMode(PDO::FETCH_ASSOC);

        echo "<table border=\"1\">\n";
        echo "<tr><td>Name</td><td>Street</td><td>City</td></tr>\n";
        while ($row = $stmt->fetch()) {
            echo "<tr><td>" . $row['ticket_id'] . "</td><td>" . $row['date'] . "</td><td>" . $row['user_id'] . "</td><td>" . $row['flight_num']. "</td></tr>\n";
        }
        echo "</table>\n";
    } else {
        echo "Insertion failed: (" . $conn->errorCode() . ") " . implode(" ", $conn->errorInfo());
    }

    $conn = null;
} catch (PDOException $e) {
    die("Could not connect to the database $dbname :" . $e->getMessage());
}


?>

</body>
</html>